# コントリビューションガイド

ShinoEditor へのコントリビューションに興味を持っていただき、ありがとうございます！
このガイドでは、プロジェクトへの貢献方法について説明します。

## 開発環境の準備

### 必須要件
- C++20対応コンパイラ (GCC 10+, Clang 11+, MSVC 2019+)
- CMake 3.16以上
- Git

### 推奨ツール
- md4c (Markdownレンダリング用)
- pandoc (DOCX入出力用)

### ビルド方法
```bash
# 通常のビルド
cmake -S . -B build && cmake --build build -j

# テスト付きビルド
cmake -S . -B build -DSHINO_BUILD_TESTS=ON && cmake --build build -j

# パフォーマンステスト付きビルド
cmake -S . -B build -DSHINO_BUILD_PERF_TESTS=ON && cmake --build build -j
```

### テストの実行
```bash
# 全テストの実行
ctest --test-dir build --output-on-failure

# 特定のテストの実行
./build/block_model_tests
./build/markdown_renderer_tests
./build/pandoc_io_tests
./build/app_tests
./build/perf_tests
```

## コーディングガイドライン

### 一般的な方針
- 既存のコードスタイルと一貫性を保つ
- 小さな変更を心がけ、大きな変更は複数のPRに分割
- 変数名は明確で意味のある名前を使用（一文字変数は避ける）
- バグ修正は根本的な原因に対処（一時的な回避策は避ける）
- UTF-8テキスト処理を適切に行う

### セキュリティガイドライン
- 外部コマンド実行時は必ずCommandValidator::SafeShellEscapeを使用
- ファイル操作時はPathValidator::ValidateFileOperationでパスを検証
- 生ポインタの代わりにスマートポインタを使用
- 未初期化メモリにアクセスしない
- バッファオーバーフローを防ぐ

### エラー処理
- エラーは適切なカテゴリのShinoErrorとして送出
- エラーメッセージは具体的で回復手順が分かるものに
- リソースリークを防ぐためRAIIを活用

### パフォーマンス考慮
- 大きなファイルでの動作を考慮
- メモリ確保は必要最小限に
- 不要なコピーを避ける
- キャッシュを適切に活用

### テスト
- 新機能には必ずユニットテストを追加
- エッジケースをテスト
- 大規模な変更にはパフォーマンステストを追加
- テストは `tests/` ディレクトリに配置

### ドキュメンテーション
- パブリックAPIには詳細なコメントを追加
- README.mdの更新が必要な変更は適切に反映
- CHANGELOGを適切に更新

## Pull Request プロセス

### コミットメッセージ
[Conventional Commits](https://www.conventionalcommits.org/ja/v1.0.0/) 形式を使用:

```
<type>(<scope>): <description>

[body]

[footer]
```

例:
```
feat(editor): 検索機能の実装

- Ctrl+W で検索プロンプトを表示
- n/p で次/前の一致に移動
- 大文字小文字を区別

Resolves: #123
```

### PR作成時の注意点
1. **タイトル**: 変更の概要を簡潔に
2. **説明**:
   - 変更の背景/動機
   - 実装の概要
   - 影響を受ける機能
   - テスト結果
   - スクリーンショット（UI変更時）
3. **レビューのポイント**:
   - 特に確認して欲しい箇所
   - 設計上の判断理由
   - 既存の代替案との比較

## バグ報告

バグを報告する際は以下の情報を含めてください:

1. 環境情報:
   - OS とバージョン
   - コンパイラとバージョン
   - 使用している外部ツール（pandoc等）のバージョン

2. 再現手順:
   - 具体的な操作手順
   - 使用したファイル（可能な場合）

3. 期待される動作と実際の動作の違い

4. エラーメッセージやログ（ある場合）

## 機能提案

新機能を提案する際は以下の情報を含めてください:

1. 提案する機能の概要
2. ユースケースと期待される効果
3. 考えられる実装方法
4. 既存の類似機能との違い

## ライセンス

- 本プロジェクトは MIT License の下で提供されます
- コントリビューションはすべて同じライセンスの下で提供されるものとします

## コミット/PR
- 可能であれば [Conventional Commits](https://www.conventionalcommits.org/ja/v1.0.0/) に準拠
- PR には再現手順・修正内容・影響範囲・テスト結果を記載

## テスト
- 重要なロジックには最小限でもテストを追加
- 既存の `tests/` に追加してください

## セキュリティ
- 外部コマンド（pandoc）実行時は引数エスケープを徹底
- 未使用の危険 API（生ポインタ、`strcpy` 等）は使用しない

## ライセンス
- 本プロジェクトへの貢献は MIT License の下で提供されます

