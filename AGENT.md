# AGENT.md — OpenAI codex CLI 用 仕様書（ShinoEditor）

## 目的
Qt なし・ターミナル上で動く Markdown エディタを C++20 + FTXUI で実装する。  
操作体系は **nano エディタ風**とし、小説や長文ドキュメントの整理・編集を主眼に置く。  
段落ブロックの折り畳みと移動を可能にしつつ、学習コストの低いキー操作で実用性を担保する。

---

## 成果物の定義（Done の条件）
1. Markdown テキストを TUI 上で編集・保存できる。  
2. nano 風ショートカットを持つ（Ctrl+O 保存, Ctrl+X 終了, Ctrl+W 検索, Ctrl+G ヘルプ）。  
3. 折り畳み対象: 見出し行・コードフェンス・引用ブロック。  
   - `Ctrl+J` : 現在ブロックを折り畳み/展開。  
   - 折り畳み時はヘッダ行のみ表示、本文は「…」で省略表現。  
4. ブロック移動:  
   - `Alt+↑` : 現在ブロックをひとつ上へ移動。  
   - `Alt+↓` : 現在ブロックをひとつ下へ移動。  
5. プレビュー画面に HTML をテキスト表示できる。`Ctrl+P` で表示切替。  
6. DOCX 読み書き: `Ctrl+I` (Import docx), `Ctrl+E` (Export docx)。Pandoc が存在しない場合はエラー表示。  
7. すべての基本操作にヘルプ行が画面下に表示されている（nano 同様）。

---

## 実装方針
- **UI**: FTXUI の `ScreenInteractive` + `Component`。エディタ領域＋プレビュー領域を横分割表示。  
- **テキスト編集**: 初期版はシンプルな一行追加/削除ベース。将来的にはカーソル移動・スクロール実装。  
- **ブロックモデル**: `BlockModel` がテキストを走査して段落ブロックを検出。  
- **折り畳み**: 折り畳み中は本文を非表示にし、代わりに「[...]」を挿入して表現。  
- **ブロック移動**: `moveBlockUp/Down` で隣接ブロックと入れ替え。Undo スタックは簡易実装でよい。  
- **ファイル入出力**: 通常の読み書き（UTF-8）。DOCX は pandoc CLI 呼び出し。  

---

## キーバインド（nano 風）
- **Ctrl+O** 保存（`Write Out`）  
- **Ctrl+X** 終了  
- **Ctrl+W** 検索（未実装時は「未対応」と表示）  
- **Ctrl+G** ヘルプ表示トグル  
- **Ctrl+J** ブロック折り畳み/展開  
- **Alt+↑/↓** ブロック上下移動  
- **Ctrl+P** プレビュー表示切替  
- **Ctrl+I** DOCX インポート（pandoc必須）  
- **Ctrl+E** DOCX エクスポート（pandoc必須）  

ヘルプ行（画面下部）は nano のように以下を表示:  
```
^O 保存  ^X 終了  ^W 検索  ^G ヘルプ  ^J フォールド  ^P プレビュー  ^I ImportDOCX  ^E ExportDOCX
```

---

## 追加ファイル/構造
```
src/
  main.cpp
  app.h / app.cpp        (メインアプリ制御)
  block_model.*          (ブロック検出)
  markdown_renderer.*    (md4cラッパ)
  pandoc_io.*            (DOCX I/O)
  tui_bindings.h         (ショートカット定義/ヘルプ行表示)
```

---

## テスト計画
1. Markdown 見出しやコードフェンスを含むテキストで折り畳みが機能する。  
2. Alt+↑/↓ でブロック移動が可能。  
3. Ctrl+O でファイル保存 → 再起動後も内容が保持される。  
4. Ctrl+P でプレビュー領域が切り替わる。  
5. Ctrl+I で DOCX を Markdown として読み込める（pandoc がインストールされている場合）。  
6. ヘルプ行に常にショートカット一覧が表示される。  

---

## 今後の拡張候補
- カーソル移動・選択・コピー&ペースト
- 行番号・ガターに折り畳みトグルマーク
- EPUB/PDF 出力
- マクロ記録・再生（繰り返し編集）
- テーマ（ダーク/ライト配色）
